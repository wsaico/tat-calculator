<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>TAT Monitor Pro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; overflow-x: hidden; font-family: system-ui, -apple-system, sans-serif; }
        input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(0.5); cursor: pointer; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Iconos SVG simplificados
        const Icon = ({ type, className = "w-5 h-5" }) => {
            const paths = {
                plane: "M2.5 19h19v2h-19v-2zm19.57-9.36c-.21-.8-1.04-1.28-1.84-1.06L14.92 10l-6.9-6.43-1.93.51 4.14 7.17-4.97 1.33-1.97-1.54-1.45.39 2.59 4.49L21 11.49c.81-.23 1.28-1.05 1.07-1.85z",
                camera: "M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z M12 17a4 4 0 1 0 0-8 4 4 0 0 0 0 8z",
                clock: "M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm1-13h-2v6l5.2 3.2.8-1.3-4-2.4V7z",
                alert: "M12 2L1 21h22L12 2zm0 6l7.5 13h-15L12 8zm-1 9h2v2h-2v-2zm0-6h2v4h-2v-4z",
                check: "M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",
                zap: "M13 2L3 14h9l-1 8 10-12h-9l1-8z",
                edit: "M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
            };
            return <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d={paths[type]} /></svg>;
        };

        const TATCalculator = () => {
            const [motorCutTime, setMotorCutTime] = useState('');
            const [itineraryMotorCutTime, setItineraryMotorCutTime] = useState('');
            const [etdTime, setETDTime] = useState('');
            const [aircraftType, setAircraftType] = useState('remolque');
            const [showItinerary, setShowItinerary] = useState(false);
            const [realTimes, setRealTimes] = useState({});
            const [currentTime, setCurrentTime] = useState(new Date());
            const [showSummary, setShowSummary] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const summaryRef = useRef(null);

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const getCurrentTimeString = () => {
                return `${String(currentTime.getHours()).padStart(2, '0')}:${String(currentTime.getMinutes()).padStart(2, '0')}`;
            };

            const processConfig = {
                remolque: {
                    tatTotal: 35,
                    processes: [
                        { id: 'motorCut', name: 'Corte Motor', offset: -35, critical: true, highlight: false },
                        { id: 'doorsOpen', name: 'Apertura Puertas', offset: -33 },
                        { id: 'disembarkEnd', name: 'Fin Desembarque', offset: -25 },
                        { id: 'cleanStart', name: 'Inicio Limpieza', offset: -25 },
                        { id: 'cleanEnd', name: 'Fin Limpieza', offset: -21 },
                        { id: 'preBoard', name: 'Pre-Embarque', offset: -27 },
                        { id: 'boardingCall', name: 'Embarque Sala', offset: -23 },
                        { id: 'baggageSearch', name: 'Búsqueda Equipaje', offset: -14 },
                        { id: 'flightDelivery', name: 'Entrega de Vuelo', offset: -12, critical: true, highlight: true },
                        { id: 'lastPax', name: 'Último Pasajero', offset: -10, critical: true },
                        { id: 'accommodation', name: 'Acomodación PAX', offset: -7 },
                        { id: 'doorsClosed', name: 'Cierre de Puertas', offset: -7, critical: true, highlight: true },
                        { id: 'engineStart', name: 'Encendido Motor', offset: -7 },
                        { id: 'pushBack', name: 'Push Back', offset: 0, critical: true },
                        { id: 'etd', name: 'ETD', offset: 0, critical: true, highlight: false }
                    ]
                },
                autopropulsado: {
                    tatTotal: 40,
                    processes: [
                        { id: 'motorCut', name: 'Corte Motor', offset: -40, critical: true, highlight: false },
                        { id: 'doorsOpen', name: 'Apertura Puertas', offset: -38 },
                        { id: 'disembarkEnd', name: 'Fin Desembarque', offset: -30 },
                        { id: 'cleanStart', name: 'Inicio Limpieza', offset: -30 },
                        { id: 'cleanEnd', name: 'Fin Limpieza', offset: -26 },
                        { id: 'preBoard', name: 'Pre-Embarque', offset: -32 },
                        { id: 'boardingCall', name: 'Embarque Sala', offset: -28 },
                        { id: 'baggageSearch', name: 'Búsqueda Equipaje', offset: -19 },
                        { id: 'flightDelivery', name: 'Entrega de Vuelo', offset: -17, critical: true, highlight: true },
                        { id: 'lastPax', name: 'Último Pasajero', offset: -15, critical: true },
                        { id: 'accommodation', name: 'Acomodación PAX', offset: -12 },
                        { id: 'doorsClosed', name: 'Cierre de Puertas', offset: -12, critical: true, highlight: true },
                        { id: 'engineStart', name: 'Encendido Motor', offset: -12 },
                        { id: 'pushBack', name: 'Push Back', offset: -5, critical: true },
                        { id: 'etd', name: 'ETD', offset: 0, critical: true, highlight: false }
                    ]
                }
            };

            const config = processConfig[aircraftType];

            const timeToMinutes = (timeStr) => {
                if (!timeStr) return 0;
                const [h, m] = timeStr.split(':').map(Number);
                return h * 60 + m;
            };

            const minutesToTime = (mins) => {
                const h = Math.floor(mins / 60);
                const m = Math.floor(mins % 60);
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
            };

            const getPlannedTime = (process) => {
                if (process.id === 'motorCut') return motorCutTime || null;
                if (process.id === 'etd') return etdTime || null;
                if (!motorCutTime) return null;
                const motorMins = timeToMinutes(motorCutTime);
                const offsetFromMotor = config.tatTotal + process.offset;
                return minutesToTime(motorMins + offsetFromMotor);
            };

            // Itinerario Comercial: anclado al "Corte Motor Itinerario" editable
            const getItineraryTime = (process) => {
                if (process.id === 'motorCut') return itineraryMotorCutTime || null;
                if (process.id === 'etd') return etdTime || null;
                if (!itineraryMotorCutTime) return null;
                const itinMotorMins = timeToMinutes(itineraryMotorCutTime);
                const offsetFromMotor = config.tatTotal + process.offset;
                return minutesToTime(itinMotorMins + offsetFromMotor);
            };

            const getTimeDiff = (planned, real) => {
                if (!real || !planned) return 0;
                return timeToMinutes(real) - timeToMinutes(planned);
            };

            const analyzeAllProcesses = () => {
                return config.processes.map(process => {
                    const planned = getPlannedTime(process);
                    const itinerary = getItineraryTime(process);
                    const real = realTimes[process.id];
                    const diff = real ? getTimeDiff(planned, real) : null;
                    const plannedMins = planned ? timeToMinutes(planned) : null;
                    const isConfigured = Boolean(motorCutTime);
                    let status;
                    if (real) {
                        status = diff > 0 ? 'late' : 'ok';
                    } else {
                        status = (!isConfigured || plannedMins === null) ? 'setup' : 'planned';
                    }
                    
                    return {
                        ...process,
                        planned,
                        itinerary,
                        real,
                        diff,
                        status
                    };
                });
            };

            const calculateActualTAT = () => {
                if (!motorCutTime) return null;
                const pushProcess = config.processes.find(p => p.id === 'pushBack');
                const plannedPush = pushProcess ? getPlannedTime(pushProcess) : null;
                const realPush = realTimes.pushBack || null;
                const endTime = realPush || plannedPush;
                if (!endTime) return null;
                return timeToMinutes(endTime) - timeToMinutes(motorCutTime);
            };

            const allProcesses = analyzeAllProcesses();
            const delays = allProcesses.filter(p => p.status === 'late');
            const improvements = allProcesses.filter(p => p.real && p.diff !== null && p.diff < 0);
            const bestImprovement = improvements.length
                ? improvements.reduce((best, p) => (best === null || p.diff < best.diff ? p : best), null)
                : null;
            const worstDelay = delays.length
                ? delays.reduce((worst, p) => (worst === null || p.diff > worst.diff ? p : worst), null)
                : null;
            const completed = allProcesses.filter(p => p.real).length;
            const actualTAT = calculateActualTAT();
            const pushProcess = config.processes.find(p => p.id === 'pushBack');
            const tatTarget = (pushProcess ? (config.tatTotal + (pushProcess.offset || 0)) : config.tatTotal);
            const tatDiff = actualTAT !== null ? (actualTAT - tatTarget) : 0;
            const tatCardClass = actualTAT === null ? 'bg-slate-600' : (tatDiff > 0 ? 'bg-red-600' : 'bg-green-600');

            const captureTime = (processId) => {
                setRealTimes(prev => ({ ...prev, [processId]: getCurrentTimeString() }));
            };

            // Método de captura de pantalla eliminado: solo se mantiene el resumen HTML

            const generateHtmlSummary = () => {
                const statusText = (s) => (
                    s === 'ok' ? 'A tiempo' :
                    s === 'late' ? 'Fuera de tiempo' :
                    s === 'planned' ? 'Planificado' :
                    'Planificar'
                );
                const nowStr = new Date().toLocaleString('es-PE');
                const delaysSorted = [...delays].sort((a, b) => b.diff - a.diff);
                const complianceText = actualTAT !== null ? (tatDiff > 0 ? `Fuera de tiempo +${tatDiff}'` : 'OK') : '--';
                const complianceClass = actualTAT !== null && tatDiff > 0 ? 'color:#dc2626' : 'color:#16a34a';

                const html = `<!DOCTYPE html>
<html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resumen TAT</title>
<style>
 body{font-family:system-ui,-apple-system,sans-serif;margin:20px;background:#fff;}
 .title{font-weight:900;color:#0f172a;font-size:20px;margin:0 0 6px;}
 .meta{font-size:12px;color:#475569;margin-bottom:14px;}
 .card{border:1px solid #cbd5e1;border-radius:10px;padding:12px;margin-bottom:10px;}
 .row{display:flex;gap:14px}
 .col{flex:1;text-align:center}
 .label{font-size:12px;color:#475569;font-weight:700}
 .value{font-size:18px;font-weight:900;color:#0f172a}
 .value-green{color:#16a34a}
 .value-red{color:#dc2626}
 table{width:100%;border-collapse:collapse;font-size:12px}
 th,td{border:1px solid #cbd5e1;padding:6px}
 thead{background:#f1f5f9}
 .section-title{font-size:13px;font-weight:900;color:#0f172a;margin:12px 0 8px}
 .delay-item{display:flex;justify-content:space-between;padding:6px;border:1px solid #fecaca;border-radius:8px;margin-bottom:6px;background:#fef2f2;color:#b91c1c}
 .crit{background:#dc2626;color:#fff;border:0}
 .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;font-weight:700}
</style></head>
<body>
  <h1 class="title">RESUMEN TAT</h1>
  <div class="meta">${nowStr} · Tipo: ${aircraftType === 'remolque' ? 'Remolque' : 'Autopropulsado'}</div>
  <div class="card row">
    <div class="col">
      <div class="label">TAT Real</div>
      <div class="value">${actualTAT !== null ? `${actualTAT}'` : `--'`} / ${tatTarget}'</div>
    </div>
    <div class="col">
      <div class="label">Cumplimiento TAT</div>
      <div class="value" style="${complianceClass}">${complianceText}</div>
    </div>
    <div class="col">
      <div class="label">Corte Motor</div>
      <div class="value mono">${motorCutTime || '--:--'}</div>
    </div>
    ${showItinerary ? `
    <div class="col">
      <div class="label">Corte Motor Itinerario</div>
      <div class="value mono">${itineraryMotorCutTime || '--:--'}</div>
    </div>` : ''}
  </div>

  <div class="section-title">${showItinerary ? 'Itinerario · Plan · Real' : 'Plan · Real'}</div>
  <table>
    <thead>
      <tr>
        <th>Proceso</th>
        ${showItinerary ? '<th>Itinerario</th>' : ''}
        <th>Plan</th>
        <th>Real</th>
        <th>Dif</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody>
      ${allProcesses.map(proc => `
        <tr>
          <td>${proc.highlight ? '⚠️ ' : ''}${proc.name}</td>
          ${showItinerary ? `<td class="mono">${proc.itinerary || '--:--'}</td>` : ''}
          <td class="mono">${proc.planned || '--:--'}</td>
          <td class="mono">${proc.real || '-'}</td>
          <td class="mono" style="${proc.diff !== null ? (proc.diff > 0 ? 'color:#dc2626' : 'color:#16a34a') : ''}">
            ${proc.diff !== null ? `${proc.diff > 0 ? '+' : ''}${proc.diff}'` : '-'}
          </td>
          <td>${statusText(proc.status)}</td>
        </tr>`).join('')}
    </tbody>
  </table>

  ${delaysSorted.length ? `
    <div class="section-title" style="color:#b91c1c">Procesos con demora</div>
    ${delaysSorted.map(proc => `
      <div class="delay-item ${proc.highlight ? 'crit' : ''}">
        <span>${proc.highlight ? '⚠️ ' : ''}${proc.name}</span>
        <span class="mono">+${proc.diff}'</span>
      </div>`).join('')}
  ` : ''}

</body></html>`;

                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `TAT_Resumen_${new Date().toISOString().slice(0,16).replace('T','_')}.html`;
                link.click();
                setTimeout(() => URL.revokeObjectURL(url), 1500);
            };

            return (
                <div className="min-h-screen bg-slate-50">
                    {/* Header */}
                    <div className="sticky top-0 z-50 bg-white shadow-md">
                        <div className="max-w-2xl mx-auto px-3 py-2.5">
                            <div className="flex items-center justify-between mb-2">
                                <div className="flex items-center gap-2">
                                    <div className="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center">
                                        <Icon type="plane" className="w-5 h-5 text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-base font-black text-slate-800">TAT Monitor</h1>
                                        <p className="text-xs text-slate-500 font-mono">{currentTime.toLocaleTimeString('es-PE', { hour12: false })}</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <button onClick={generateHtmlSummary} className="px-2 h-9 bg-slate-800 text-white rounded-lg text-xs font-bold active:bg-slate-900">Ver Resumen</button>
                                    <button onClick={() => setShowItinerary(v => !v)} className={`px-2 h-9 rounded-lg text-xs font-bold border ${showItinerary ? 'bg-emerald-600 text-white border-emerald-700' : 'bg-slate-100 text-slate-700 border-slate-300'}`}>
                                        {showItinerary ? 'Itinerario comercial: ON' : 'Itinerario comercial: OFF'}
                                    </button>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2">
                                <button onClick={() => setAircraftType('remolque')} className={`py-1.5 rounded-lg text-xs font-bold ${aircraftType === 'remolque' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700'}`}>
                                    TAT 35
                                </button>
                                <button onClick={() => setAircraftType('autopropulsado')} className={`py-1.5 rounded-lg text-xs font-bold ${aircraftType === 'autopropulsado' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700'}`}>
                                    TAT 40
                                </button>
                            </div>

                            {/* Switch de itinerario comercial movido al header junto al botón de resumen */}

                            {worstDelay && (
                                <div className="mt-2 flex items-center gap-2 px-2 py-1 bg-red-50 border border-red-200 rounded">
                                    <Icon type="alert" className="w-4 h-4 text-red-700" />
                                    <span className="text-xs font-bold text-red-700">Fuera de tiempo +{worstDelay.diff}'</span>
                                    <span className="text-xs text-red-700">en {worstDelay.name}</span>
                                </div>
                            )}

                            {bestImprovement && (
                                <div className="mt-2 flex items-center gap-2 px-2 py-1 bg-green-50 border border-green-200 rounded">
                                    <Icon type="check" className="w-4 h-4 text-green-700" />
                                    <span className="text-xs font-bold text-green-700">Ganando {Math.abs(bestImprovement.diff)}'</span>
                                    <span className="text-xs text-green-700">en {bestImprovement.name}</span>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="max-w-2xl mx-auto px-3 py-3 pb-20">
                        {/* Config Base */}
                        <div className="bg-white rounded-lg shadow-sm p-3 mb-3">
                            <div className={`grid ${showItinerary ? 'grid-cols-3' : 'grid-cols-2'} gap-3`}>
                                <div>
                                    <label className="text-xs font-bold text-slate-600 mb-1 block">Corte Motor</label>
                                    <input type="time" value={motorCutTime} onChange={(e) => setMotorCutTime(e.target.value)} 
                                        className="w-full px-2.5 py-1.5 bg-blue-50 border border-blue-300 rounded font-mono text-sm font-bold text-blue-900" />
                                </div>
                                {showItinerary && (
                                    <div>
                                        <label className="text-xs font-bold text-slate-600 mb-1 block">Corte Motor Itinerario (Comercial)</label>
                                        <input type="time" value={itineraryMotorCutTime} onChange={(e) => setItineraryMotorCutTime(e.target.value)} 
                                            className="w-full px-2.5 py-1.5 bg-emerald-50 border border-emerald-300 rounded font-mono text-sm font-bold text-emerald-900" />
                                    </div>
                                )}
                                <div>
                                    <label className="text-xs font-bold text-slate-600 mb-1 block">ETD Plan</label>
                                    <input type="time" value={etdTime} onChange={(e) => setETDTime(e.target.value)} 
                                        className="w-full px-2.5 py-1.5 bg-green-50 border border-green-300 rounded font-mono text-sm font-bold text-green-900" />
                                </div>
                            </div>
                        </div>

                        {/* Métricas */}
                        <div className="grid grid-cols-3 gap-2 mb-3">
                            <div className={`rounded-lg p-2.5 ${tatCardClass}`}>
                                <div className="text-white/70 text-xs font-bold">TAT</div>
                                <div className="text-white text-xl font-black">{actualTAT !== null ? `${actualTAT}'` : `--'`}</div>
                                <div className="text-white/80 text-xs">/{tatTarget}'</div>
                            </div>
                            <div className="rounded-lg p-2.5 bg-blue-600">
                                <div className="text-white/70 text-xs font-bold">Progreso</div>
                                <div className="text-white text-xl font-black">{completed}</div>
                                <div className="text-white/80 text-xs">/{config.processes.length}</div>
                            </div>
                            <div className={`rounded-lg p-2.5 ${delays.length > 0 ? 'bg-orange-600' : 'bg-slate-600'}`}>
                                <div className="text-white/70 text-xs font-bold">Retrasos</div>
                                <div className="text-white text-xl font-black">{delays.length}</div>
                                <div className="text-white/80 text-xs">detectados</div>
                            </div>
                        </div>

                        {/* (Movido) Alertas de Retrasos se muestran al final */}

                        {/* Timeline Procesos */
                        }
                        <div className="space-y-2">
                            {allProcesses.map((proc) => {
                                const isManual = proc.id === 'motorCut' || proc.id === 'etd';
                                const statusColors = {
                                    late: 'border-red-500 bg-red-50',
                                    ok: 'border-green-500 bg-green-50',
                                    planned: 'border-slate-300 bg-white',
                                    setup: 'border-slate-300 bg-white'
                                };
                                const badgeText =
                                    proc.status === 'ok' ? 'A tiempo' :
                                    proc.status === 'planned' ? 'Planificado' :
                                    proc.status === 'setup' ? 'Planificar' :
                                    'Fuera de tiempo';
                                const badgeClass =
                                    proc.status === 'ok' ? 'bg-green-100 text-green-700 border border-green-200' :
                                    (proc.status === 'planned' || proc.status === 'setup') ? 'bg-slate-100 text-slate-700 border border-slate-200' :
                                    'bg-red-100 text-red-700 border border-red-200';
                                
                                return (
                                    <div key={proc.id} className={`rounded-lg border-l-4 ${statusColors[proc.status]} ${proc.highlight && proc.status !== 'ok' ? 'ring-2 ring-red-300' : ''} shadow-sm`}>
                                        <div className="p-2.5">
                                            <div>
                                                <div className="flex items-center justify-between gap-2">
                                                    <div className="flex items-center gap-2">
                                                        <h4 className="text-sm font-bold text-slate-800">{proc.name}</h4>
                                                        {proc.highlight && <span className="text-xs px-1.5 py-0.5 bg-red-600 text-white rounded font-bold">CRÍTICO</span>}
                                                    </div>
                                                    <span className={`text-xs font-bold rounded-full px-2 py-0.5 ${badgeClass}`}>{badgeText}</span>
                                                </div>
                                                <div className="flex items-center justify-between mt-1">
                                                <div className="flex items-center gap-2 flex-wrap">
                                                    <span className="text-xs text-slate-500 font-semibold">Plan: <span className="font-mono font-bold text-slate-700">{proc.planned || '--:--'}</span></span>
                                                    {showItinerary && (
                                                        <span className="text-xs text-slate-500 font-semibold">Itin: <span className="font-mono font-bold text-slate-700">{proc.itinerary || '--:--'}</span></span>
                                                    )}
                                                    {proc.diff !== null && (
                                                        <span className={`text-xs px-1.5 py-0.5 rounded font-bold ${proc.diff > 0 ? 'bg-red-600 text-white' : 'bg-green-600 text-white'}`}>
                                                            {proc.diff > 0 ? '+' : ''}{proc.diff}'
                                                        </span>
                                                    )}
                                                </div>
                                                    {!isManual && (
                                                        <div className="flex items-center gap-2 flex-wrap justify-end">
                                                            {!proc.real ? (
                                                                <button onClick={() => captureTime(proc.id)} 
                                                                    className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-bold active:bg-blue-700 flex items-center justify-center gap-1.5">
                                                                    <Icon type="zap" className="w-3.5 h-3.5" />
                                                                    Capturar
                                                                </button>
                                                            ) : (
                                                                <>
                                                                    <div className="px-2 py-1.5 bg-slate-100 rounded">
                                                                        <span className="text-xs text-slate-500 font-semibold">Real: </span>
                                                                        <span className="font-mono text-sm font-bold text-slate-800">{proc.real}</span>
                                                                    </div>
                                                                    <button onClick={() => setEditingId(proc.id)} className="px-2.5 py-1.5 bg-slate-300 rounded active:bg-slate-400">
                                                                        <Icon type="edit" className="w-3.5 h-3.5 text-slate-700" />
                                                                    </button>
                                                                </>
                                                            )}
                                                            {editingId === proc.id && (
                                                                <>
                                                                    <input type="time" value={realTimes[proc.id] || ''} 
                                                                        onChange={(e) => setRealTimes(prev => ({ ...prev, [proc.id]: e.target.value }))}
                                                                        className="w-24 px-2 py-1 border border-slate-300 rounded font-mono text-xs font-bold" />
                                                                    <button onClick={() => setEditingId(null)} className="px-2.5 py-1 bg-blue-600 text-white rounded text-xs font-bold">OK</button>
                                                                    <button onClick={() => {
                                                                        setRealTimes(prev => { const n = {...prev}; delete n[proc.id]; return n; });
                                                                        setEditingId(null);
                                                                    }} className="px-2.5 py-1 bg-red-600 text-white rounded text-xs font-bold">
                                                                        Borrar
                                                                    </button>
                                                                </>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* Alertas de Retrasos (al final con scroll) */}
                        {delays.length > 0 && (
                            <div className="bg-red-50 border-l-4 border-red-600 rounded-lg p-3 mt-3">
                                <div className="flex items-center gap-2 mb-2">
                                    <Icon type="alert" className="w-4 h-4 text-red-600" />
                                    <span className="text-xs font-black text-red-900">RETRASOS DETECTADOS</span>
                                </div>
                                <div className="max-h-48 overflow-auto hide-scrollbar space-y-1.5">
                                    {delays.map((proc) => (
                                        <div key={proc.id} className={`flex justify-between items-center p-2 rounded ${proc.highlight ? 'bg-red-600 text-white' : 'bg-white'}`}>
                                            <span className={`text-xs font-bold ${proc.highlight ? 'text-white' : 'text-slate-800'}`}>
                                                {proc.highlight && '⚠️ '}{proc.name}
                                            </span>
                                            <span className={`text-sm font-black ${proc.highlight ? 'text-white' : 'text-red-600'}`}>
                                                +{proc.diff}'
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Modal Resumen */}
                    {showSummary && (
                        <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-auto" ref={summaryRef}>
                                <div className="p-5">
                                    <div className="text-center mb-4 pb-4 border-b-2 border-slate-200">
                                        <h2 className="text-xl font-black text-slate-800">RESUMEN TAT</h2>
                                        <p className="text-xs text-slate-500 mt-1 font-mono">{new Date().toLocaleString('es-PE')}</p>
                                        <div className="flex justify-center gap-4 mt-3">
                                            <div className="text-center">
                                                <div className="text-xs text-slate-600 font-bold">Tipo</div>
                                                <div className="text-sm font-black text-slate-800">{aircraftType === 'remolque' ? 'Remolque' : 'Autopropulsado'}</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-xs text-slate-600 font-bold">TAT Real</div>
                                                <div className={`text-sm font-black ${tatDiff > 0 ? 'text-red-600' : 'text-green-600'}`}>
                                                    {actualTAT !== null ? `${actualTAT}'` : `--'`} / {tatTarget}'
                                                </div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-xs text-slate-600 font-bold">Cumplimiento TAT</div>
                                                <div className={`text-sm font-black ${actualTAT !== null && tatDiff > 0 ? 'text-red-600' : 'text-green-600'}`}>
                                                    {actualTAT !== null ? (tatDiff > 0 ? `Fuera de tiempo +${tatDiff}'` : 'OK') : '--'}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Tabla Resumen Completo */}
                                    <div className="mb-4">
                                        <h3 className="text-sm font-black text-slate-800 mb-2">ITINERARIO · PLAN · REAL</h3>
                                        <div className="border border-slate-300 rounded-lg overflow-hidden">
                                            <table className="w-full text-xs">
                                                <thead className="bg-slate-100">
                                                    <tr>
                                                        <th className="text-left p-2 font-bold text-slate-700">Proceso</th>
                                                        {showItinerary && (<th className="text-center p-2 font-bold text-slate-700">Itinerario</th>)}
                                                        <th className="text-center p-2 font-bold text-slate-700">Plan</th>
                                                        <th className="text-center p-2 font-bold text-slate-700">Real</th>
                                                        <th className="text-center p-2 font-bold text-slate-700">Dif</th>
                                                        <th className="text-center p-2 font-bold text-slate-700">Estado</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {allProcesses.map((proc, idx) => (
                                                        <tr key={proc.id} className={idx % 2 === 0 ? 'bg-white' : 'bg-slate-50'}>
                                                            <td className="p-2 font-semibold text-slate-800">
                                                                {proc.highlight && '⚠️ '}{proc.name}
                                                            </td>
                                                            {showItinerary && (
                                                                <td className="p-2 text-center font-mono font-bold text-slate-700">{proc.itinerary || '--:--'}</td>
                                                            )}
                                                            <td className="p-2 text-center font-mono font-bold text-slate-700">{proc.planned}</td>
                                                            <td className="p-2 text-center font-mono font-bold text-slate-800">
                                                                {proc.real || '-'}
                                                            </td>
                                                            <td className="p-2 text-center font-bold">
                                                                {proc.diff !== null ? (
                                                                    <span className={proc.diff > 0 ? 'text-red-600' : 'text-green-600'}>
                                                                        {proc.diff > 0 ? '+' : ''}{proc.diff}'
                                                                    </span>
                                                                ) : '-'}
                                                            </td>
                                                            <td className="p-2 text-center">
                                                                {proc.status === 'ok' && <span className="text-green-600 font-bold">✓ A tiempo</span>}
                                                                {proc.status === 'late' && <span className="text-red-600 font-bold">✗ Fuera de tiempo</span>}
                                                                {proc.status === 'planned' && <span className="text-slate-600 font-bold">• Planificado</span>}
                                                                {proc.status === 'setup' && <span className="text-slate-400 font-bold">○ Planificar</span>}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    {/* Procesos con demora */}
                                    {delays.length > 0 && (
                                        <div className="mb-4">
                                            <h3 className="text-sm font-black text-red-700 mb-2">PROCESOS CON DEMORA</h3>
                                            <div className="border border-red-200 rounded-lg overflow-hidden">
                                                {delays.map((proc) => (
                                                    <div key={proc.id} className={`flex justify-between items-center p-2 ${proc.highlight ? 'bg-red-600 text-white' : 'bg-red-50 text-red-700'}`}>
                                                        <span className="text-xs font-bold">{proc.highlight ? '⚠️ ' : ''}{proc.name}</span>
                                                        <span className="text-sm font-black">+{proc.diff}'</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Resumen de Cumplimiento */}
                                    <div className="grid grid-cols-3 gap-3 mb-4">
                                        <div className="bg-green-50 border border-green-300 rounded-lg p-3 text-center">
                                            <div className="text-2xl font-black text-green-600">
                                                {allProcesses.filter(p => p.status === 'ok').length}
                                            </div>
                                            <div className="text-xs font-bold text-green-700">A Tiempo</div>
                                        </div>
                                        <div className="bg-red-50 border border-red-300 rounded-lg p-3 text-center">
                                            <div className="text-2xl font-black text-red-600">
                                                {allProcesses.filter(p => p.status === 'late').length}
                                            </div>
                                            <div className="text-xs font-bold text-red-700">Retrasados</div>
                                        </div>
                                        <div className="bg-slate-50 border border-slate-300 rounded-lg p-3 text-center">
                                            <div className="text-2xl font-black text-slate-600">
                                                {allProcesses.filter(p => p.status === 'planned' || p.status === 'setup').length}
                                            </div>
                                            <div className="text-xs font-bold text-slate-700">Pendientes</div>
                                        </div>
                                    </div>

                                    <button onClick={() => setShowSummary(false)} className="w-full py-2.5 bg-slate-800 text-white rounded-lg font-bold text-sm active:bg-slate-900">
                                        Cerrar Resumen
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<TATCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
